# v0.3 é–‹ç™¼è¨ˆåŠƒ

**ç‰ˆæœ¬**: v0.3
**é–‹å§‹æ—¥æœŸ**: 2025-10-16
**ç‹€æ…‹**: ğŸ¯ è¨ˆåŠƒä¸­

---

## ğŸ¯ ç›®æ¨™

1. **æª”æ¡ˆè·¯å¾‘æ›´è‡ªç”±** - æ”¯æ´ä»»æ„å­è³‡æ–™å¤¾çµæ§‹
2. **æ”¹ç”¨ SVG æ ¼å¼** - Kroki è¼¸å‡º SVG è€Œé PNGï¼ˆå‘é‡åœ–ã€è¦†è“‹ç‡é«˜ï¼‰
3. **æ”¯æ´æ›´å¤šåœ–è¡¨é¡å‹** - æ“´å±• Kroki åœ–è¡¨é¡å‹æ”¯æ´

## ğŸ”‘ æ ¸å¿ƒæ”¹è®Šï¼šSVG å„ªå…ˆ

### ç‚ºä»€éº¼æ”¹ç”¨ SVGï¼Ÿ

**å•é¡Œï¼šPNG é™åˆ¶**
- âŒ D2 ä¸æ”¯æ´ PNGï¼ˆåªæœ‰ SVGï¼‰
- âŒ BPMN ä¸æ”¯æ´ PNGï¼ˆåªæœ‰ SVGï¼‰
- âŒ Excalidraw ä¸æ”¯æ´ PNGï¼ˆåªæœ‰ SVGï¼‰
- âŒ PNG æ˜¯é»é™£åœ–ï¼Œæ”¾å¤§æœƒæ¨¡ç³Š

**è§£æ±ºï¼šSVG å„ªå‹¢**
- âœ… æ”¯æ´æœ€å»£æ³›ï¼ˆå¹¾ä¹æ‰€æœ‰ Kroki åœ–è¡¨éƒ½æ”¯æ´ï¼‰
- âœ… å‘é‡åœ–ï¼Œç„¡é™ç¸®æ”¾ä¸å¤±çœŸ
- âœ… æª”æ¡ˆæ›´å°
- âœ… Markdown å®Œå…¨æ”¯æ´
- âœ… å¯ä»¥è¤‡è£½æ–‡å­—å…§å®¹

### HTTP éŸ¿æ‡‰è®ŠåŒ–

**v0.1 (èˆŠ):**
```http
GET /demo/livedoc/dynamic/demo.puml
â†’ Content-Type: image/png
â†’ PNG åœ–ç‰‡
```

**v0.3 (æ–°):**
```http
GET /demo/livedoc/architecture/system.d2
â†’ Content-Type: image/svg+xml
â†’ SVG åœ–ç‰‡
```

---

## ğŸ“‹ åŠŸèƒ½æ¸…å–®

### 1. æª”æ¡ˆè·¯å¾‘è‡ªç”±åŒ–

**å¾ï¼š**
```
å›ºå®šçµæ§‹ï¼š
livedoc/static/{file}
livedoc/dynamic/{file}

URL: /{project}/livedoc/{static|dynamic}/{file}
```

**åˆ°ï¼š**
```
è‡ªç”±çµæ§‹ï¼š
livedoc/{ä»»æ„è·¯å¾‘}/{file}

URL: /{project}/livedoc/{ä»»æ„è·¯å¾‘}/{file}
```

**ç¯„ä¾‹ï¼š**
```
livedoc/
â”œâ”€â”€ architecture/
â”‚   â”œâ”€â”€ system.puml
â”‚   â”œâ”€â”€ database.puml
â”‚   â””â”€â”€ logo.png
â”œâ”€â”€ diagrams/
â”‚   â”œâ”€â”€ flowchart.mmd
â”‚   â”œâ”€â”€ sequence.d2
â”‚   â””â”€â”€ erd.erd
â””â”€â”€ monitoring/
    â””â”€â”€ waveform.wavedrom
```

### 2. æ“´å±• Kroki åœ–è¡¨æ”¯æ´

**v0.1 å·²æ”¯æ´ï¼š**
- PlantUML (.puml)
- Mermaid (.mmd)

**v0.3 æ–°å¢æ”¯æ´ï¼ˆåŸºæ–¼ Krokiï¼‰ï¼š**

**æ¶æ§‹åœ–é¡ï¼š**
- `.d2` - D2 diagrams
- `.c4` - C4 with PlantUML
- `.structurizr` - Structurizr

**æµç¨‹åœ–é¡ï¼š**
- `.bpmn` - BPMN
- `.nomnoml` - Nomnoml
- `.graphviz` / `.dot` - GraphViz

**æ•¸æ“šåœ–é¡ï¼š**
- `.vega` - Vega
- `.vegalite` - Vega-Lite
- `.ditaa` - Ditaa

**å°ˆæ¥­åœ–é¡ï¼š**
- `.erd` - Entity Relationship Diagrams
- `.dbml` - DBML (Database Markup Language)
- `.wavedrom` - WaveDrom (æ™‚åºåœ–)
- `.pikchr` - Pikchr
- `.wireviz` - WireViz (æ¥ç·šåœ–)

**ç¶²è·¯/ç³»çµ±åœ–ï¼š**
- `.nwdiag` - Network diagrams
- `.rackdiag` - Rack diagrams
- `.packetdiag` - Packet diagrams
- `.seqdiag` - Sequence diagrams (å¦ä¸€ç¨®æ ¼å¼)
- `.actdiag` - Activity diagrams
- `.blockdiag` - Block diagrams

**å…¶ä»–ï¼š**
- `.bytefield` - Bytefield
- `.excalidraw` - Excalidraw
- `.svgbob` - Svgbob
- `.tikz` - TikZ

---

## ğŸ”§ æŠ€è¡“å¯¦ä½œ

### 1. Router ä¿®æ”¹

**èˆŠé‚è¼¯ï¼š**
```javascript
app.get('/:project/livedoc/:type/:filename', ...)
// type å¿…é ˆæ˜¯ 'static' æˆ– 'dynamic'
```

**æ–°é‚è¼¯ï¼š**
```javascript
app.get('/:project/livedoc/*', ...)
// * åŒ¹é…ä»»æ„è·¯å¾‘
// æ ¹æ“šå‰¯æª”ååˆ¤æ–·è™•ç†æ–¹å¼
```

### 2. å‰¯æª”åæ˜ å°„è¡¨

```javascript
const EXTENSION_HANDLERS = {
  // éœæ…‹åœ–ç‰‡
  '.png': 'static',
  '.jpg': 'static',
  '.jpeg': 'static',
  '.gif': 'static',
  '.svg': 'static',

  // Kroki å‹•æ…‹åœ–è¡¨
  '.puml': 'plantuml',
  '.mmd': 'mermaid',
  '.d2': 'd2',
  '.c4': 'c4plantuml',
  '.structurizr': 'structurizr',
  '.bpmn': 'bpmn',
  '.nomnoml': 'nomnoml',
  '.dot': 'graphviz',
  '.graphviz': 'graphviz',
  '.vega': 'vega',
  '.vegalite': 'vegalite',
  '.ditaa': 'ditaa',
  '.erd': 'erd',
  '.dbml': 'dbml',
  '.wavedrom': 'wavedrom',
  '.pikchr': 'pikchr',
  '.wireviz': 'wireviz',
  '.nwdiag': 'nwdiag',
  '.rackdiag': 'rackdiag',
  '.packetdiag': 'packetdiag',
  '.seqdiag': 'seqdiag',
  '.actdiag': 'actdiag',
  '.blockdiag': 'blockdiag',
  '.bytefield': 'bytefield',
  '.excalidraw': 'excalidraw',
  '.svgbob': 'svgbob',
  '.tikz': 'tikz'
};
```

### 3. å‘å¾Œå…¼å®¹

ç¢ºä¿èˆŠçš„ URL ä»ç„¶å¯ç”¨ï¼š
```
âœ… http://localhost:3000/demo/livedoc/static/test.png
âœ… http://localhost:3000/demo/livedoc/dynamic/demo.puml
âœ… http://localhost:3000/demo/livedoc/architecture/system.puml (æ–°)
```

---

## ğŸ§ª æ¸¬è©¦æ–‡ä»¶

### æ¸¬è©¦ç›®éŒ„çµæ§‹
```
demo/livedoc/
â”œâ”€â”€ static/           # èˆŠæ ¼å¼ï¼ˆå‘å¾Œå…¼å®¹ï¼‰
â”‚   â”œâ”€â”€ test.png
â”‚   â”œâ”€â”€ test.jpg
â”‚   â”œâ”€â”€ test.gif
â”‚   â””â”€â”€ test.svg
â”‚
â”œâ”€â”€ dynamic/          # èˆŠæ ¼å¼ï¼ˆå‘å¾Œå…¼å®¹ï¼‰
â”‚   â”œâ”€â”€ demo.puml
â”‚   â”œâ”€â”€ flow.mmd
â”‚   â””â”€â”€ error.puml
â”‚
â”œâ”€â”€ architecture/     # æ–°æ ¼å¼ï¼ˆè‡ªç”±è·¯å¾‘ï¼‰
â”‚   â”œâ”€â”€ system.d2
â”‚   â”œâ”€â”€ database.erd
â”‚   â””â”€â”€ logo.png
â”‚
â”œâ”€â”€ diagrams/         # æ–°æ ¼å¼ï¼ˆæ¸¬è©¦å„ç¨®åœ–è¡¨ï¼‰
â”‚   â”œâ”€â”€ flowchart.nomnoml
â”‚   â”œâ”€â”€ network.nwdiag
â”‚   â”œâ”€â”€ sequence.seqdiag
â”‚   â”œâ”€â”€ waveform.wavedrom
â”‚   â”œâ”€â”€ chart.vegalite
â”‚   â””â”€â”€ ascii.ditaa
â”‚
â””â”€â”€ process/
    â”œâ”€â”€ bpmn-flow.bpmn
    â””â”€â”€ activity.actdiag
```

### æ¸¬è©¦æ¸…å–®

**éœæ…‹åœ–ç‰‡ï¼ˆå‘å¾Œå…¼å®¹ï¼‰ï¼š**
- [ ] PNG
- [ ] JPG
- [ ] GIF
- [ ] SVG

**åŸæœ‰å‹•æ…‹åœ–è¡¨ï¼ˆå‘å¾Œå…¼å®¹ï¼‰ï¼š**
- [ ] PlantUML (.puml)
- [ ] Mermaid (.mmd)

**æ–°å¢åœ–è¡¨é¡å‹ï¼š**
- [ ] D2 (.d2) - ç¾ä»£æ¶æ§‹åœ–
- [ ] ERD (.erd) - è³‡æ–™åº« ER åœ–
- [ ] Nomnoml (.nomnoml) - ç°¡å–® UML
- [ ] Network Diagram (.nwdiag) - ç¶²è·¯æ‹“æ¨¸
- [ ] Sequence Diagram (.seqdiag) - åºåˆ—åœ–
- [ ] WaveDrom (.wavedrom) - æ™‚åºæ³¢å½¢åœ–
- [ ] Vega-Lite (.vegalite) - æ•¸æ“šè¦–è¦ºåŒ–
- [ ] Ditaa (.ditaa) - ASCII è—è¡“åœ–
- [ ] BPMN (.bpmn) - æ¥­å‹™æµç¨‹
- [ ] Activity Diagram (.actdiag) - æ´»å‹•åœ–

**éŒ¯èª¤è™•ç†ï¼š**
- [ ] ä¸æ”¯æ´çš„å‰¯æª”å â†’ éŒ¯èª¤åœ–ç‰‡
- [ ] èªæ³•éŒ¯èª¤ â†’ éŒ¯èª¤åœ–ç‰‡
- [ ] æª”æ¡ˆä¸å­˜åœ¨ â†’ éŒ¯èª¤åœ–ç‰‡

---

## ğŸ“ å¯¦ä½œä»»å‹™

### Phase 1: Router é‡æ§‹
- [ ] ä¿®æ”¹ `src/server/router.js` - æ”¯æ´ä»»æ„è·¯å¾‘
- [ ] å‰µå»º `src/utils/extension-map.js` - å‰¯æª”åæ˜ å°„è¡¨
- [ ] æ›´æ–° `src/server/handlers/dynamic.js` - æ¥å— Kroki é¡å‹åƒæ•¸

### Phase 2: æ“´å±•åœ–è¡¨æ”¯æ´
- [ ] æ›´æ–° `src/utils/kroki.js` - æ”¯æ´æ›´å¤šåœ–è¡¨é¡å‹
- [ ] æ›´æ–° `src/utils/mime-types.js` - æ·»åŠ æ–°å‰¯æª”å

### Phase 3: æ¸¬è©¦æ–‡ä»¶
- [ ] å‰µå»ºå„ç¨®åœ–è¡¨æ¸¬è©¦æ–‡ä»¶
- [ ] æ›´æ–° `demo/README.md` - å±•ç¤ºæ–°åŠŸèƒ½

### Phase 4: æ–‡æª”æ›´æ–°
- [ ] æ›´æ–° `docs/ROADMAP.md`
- [ ] æ›´æ–° `src/README.md`
- [ ] æ›´æ–°ä¸» `README.md`

### Phase 5: å‘å¾Œå…¼å®¹æ¸¬è©¦
- [ ] æ¸¬è©¦èˆŠ URL æ ¼å¼
- [ ] æ¸¬è©¦æ–° URL æ ¼å¼
- [ ] æ¸¬è©¦æ··åˆä½¿ç”¨

---

## âš ï¸ æ³¨æ„äº‹é …

1. **ä¿æŒ livedoc/ ç‚ºå›ºå®šæ ¹ç›®éŒ„** - ä¸è®Š
2. **å‘å¾Œå…¼å®¹** - èˆŠçš„ static/dynamic è·¯å¾‘å¿…é ˆç¹¼çºŒå¯ç”¨
3. **éŒ¯èª¤è™•ç†ä¸€è‡´** - æ°¸é è¿”å› 200 + image/png
4. **æ—¥èªŒæ ¼å¼** - è¨˜éŒ„å®Œæ•´è·¯å¾‘

---

## ğŸ“Š é æœŸæˆæœ

**ä½¿ç”¨ç¯„ä¾‹ï¼š**
```markdown
# æ¶æ§‹åœ–ï¼ˆè‡ªç”±è·¯å¾‘ï¼‰
![ç³»çµ±æ¶æ§‹](http://localhost:3000/myapp/livedoc/architecture/system.d2)
![è³‡æ–™åº«è¨­è¨ˆ](http://localhost:3000/myapp/livedoc/architecture/database.erd)

# æµç¨‹åœ–ï¼ˆè‡ªç”±è·¯å¾‘ï¼‰
![æ¥­å‹™æµç¨‹](http://localhost:3000/myapp/livedoc/process/workflow.bpmn)
![æ´»å‹•åœ–](http://localhost:3000/myapp/livedoc/diagrams/activity.actdiag)

# ç¶²è·¯åœ–ï¼ˆè‡ªç”±è·¯å¾‘ï¼‰
![ç¶²è·¯æ‹“æ¨¸](http://localhost:3000/myapp/livedoc/network/topology.nwdiag)

# æ™‚åºåœ–ï¼ˆè‡ªç”±è·¯å¾‘ï¼‰
![æ³¢å½¢åœ–](http://localhost:3000/myapp/livedoc/hardware/timing.wavedrom)

# å‘å¾Œå…¼å®¹ï¼ˆèˆŠè·¯å¾‘ï¼‰
![Logo](http://localhost:3000/myapp/livedoc/static/logo.png)
![PlantUML](http://localhost:3000/myapp/livedoc/dynamic/arch.puml)
```

---

**æ›´æ–°æ™‚é–“**: 2025-10-16
