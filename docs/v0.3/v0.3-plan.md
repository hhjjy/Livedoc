# v0.3 é–‹ç™¼è¨ˆåŠƒ

**ç‰ˆæœ¬**: v0.3
**é–‹å§‹æ—¥æœŸ**: 2025-10-16
**ç‹€æ…‹**: ğŸ¯ è¨ˆåŠƒä¸­

---

## ğŸ¯ ç›®æ¨™

1. **æª”æ¡ˆè·¯å¾‘æ›´è‡ªç”±** - æ”¯æ´ä»»æ„å­è³‡æ–™å¤¾çµæ§‹
2. **æ”¹ç”¨ SVG æ ¼å¼** - Kroki è¼¸å‡º SVG è€Œé PNGï¼ˆå‘é‡åœ–ã€è¦†è“‹ç‡é«˜ï¼‰
3. **æ”¯æ´æ›´å¤šåœ–è¡¨é¡å‹** - æ“´å±• Kroki åœ–è¡¨é¡å‹æ”¯æ´

## ğŸ”‘ æ ¸å¿ƒæ”¹è®Šï¼šSVG å„ªå…ˆ

### ç‚ºä»€éº¼æ”¹ç”¨ SVGï¼Ÿ

**å•é¡Œï¼šPNG é™åˆ¶**
- âŒ D2 ä¸æ”¯æ´ PNGï¼ˆåªæœ‰ SVGï¼‰
- âŒ BPMN ä¸æ”¯æ´ PNGï¼ˆåªæœ‰ SVGï¼‰
- âŒ Excalidraw ä¸æ”¯æ´ PNGï¼ˆåªæœ‰ SVGï¼‰
- âŒ PNG æ˜¯é»é™£åœ–ï¼Œæ”¾å¤§æœƒæ¨¡ç³Š

**è§£æ±ºï¼šSVG å„ªå‹¢**
- âœ… æ”¯æ´æœ€å»£æ³›ï¼ˆå¹¾ä¹æ‰€æœ‰ Kroki åœ–è¡¨éƒ½æ”¯æ´ï¼‰
- âœ… å‘é‡åœ–ï¼Œç„¡é™ç¸®æ”¾ä¸å¤±çœŸ
- âœ… æª”æ¡ˆæ›´å°
- âœ… Markdown å®Œå…¨æ”¯æ´
- âœ… å¯ä»¥è¤‡è£½æ–‡å­—å…§å®¹

### HTTP éŸ¿æ‡‰è®ŠåŒ–

**v0.1 (èˆŠ):**
```http
GET /demo/livedoc/dynamic/demo.puml
â†’ Content-Type: image/png
â†’ PNG åœ–ç‰‡
```

**v0.3 (æ–°):**
```http
GET /demo/livedoc/architecture/system.d2
â†’ Content-Type: image/svg+xml
â†’ SVG åœ–ç‰‡
```

---

## ğŸ“‹ åŠŸèƒ½æ¸…å–®

### 1. æª”æ¡ˆè·¯å¾‘è‡ªç”±åŒ–

**å¾ï¼š**
```
å›ºå®šçµæ§‹ï¼š
livedoc/static/{file}
livedoc/dynamic/{file}

URL: /{project}/livedoc/{static|dynamic}/{file}
```

**åˆ°ï¼š**
```
è‡ªç”±çµæ§‹ï¼š
livedoc/{ä»»æ„è·¯å¾‘}/{file}

URL: /{project}/livedoc/{ä»»æ„è·¯å¾‘}/{file}
```

**ç¯„ä¾‹ï¼š**
```
livedoc/
â”œâ”€â”€ architecture/
â”‚   â”œâ”€â”€ system.puml
â”‚   â”œâ”€â”€ database.puml
â”‚   â””â”€â”€ logo.png
â”œâ”€â”€ diagrams/
â”‚   â”œâ”€â”€ flowchart.mmd
â”‚   â”œâ”€â”€ sequence.d2
â”‚   â””â”€â”€ erd.erd
â””â”€â”€ monitoring/
    â””â”€â”€ waveform.wavedrom
```

### 2. æ“´å±• Kroki åœ–è¡¨æ”¯æ´

**v0.1 å·²æ”¯æ´ï¼š**
- PlantUML (.puml)
- Mermaid (.mmd)

**v0.3 æ–°å¢æ”¯æ´ï¼ˆåŸºæ–¼ Krokiï¼‰ï¼š**

**æ¶æ§‹åœ–é¡ï¼š**
- `.d2` - D2 diagrams
- `.c4` - C4 with PlantUML
- `.structurizr` - Structurizr

**æµç¨‹åœ–é¡ï¼š**
- `.bpmn` - BPMN
- `.nomnoml` - Nomnoml
- `.graphviz` / `.dot` - GraphViz

**æ•¸æ“šåœ–é¡ï¼š**
- `.vega` - Vega
- `.vegalite` - Vega-Lite
- `.ditaa` - Ditaa

**å°ˆæ¥­åœ–é¡ï¼š**
- `.erd` - Entity Relationship Diagrams
- `.dbml` - DBML (Database Markup Language)
- `.wavedrom` - WaveDrom (æ™‚åºåœ–)
- `.pikchr` - Pikchr
- `.wireviz` - WireViz (æ¥ç·šåœ–)

**ç¶²è·¯/ç³»çµ±åœ–ï¼š**
- `.nwdiag` - Network diagrams
- `.rackdiag` - Rack diagrams
- `.packetdiag` - Packet diagrams
- `.seqdiag` - Sequence diagrams (å¦ä¸€ç¨®æ ¼å¼)
- `.actdiag` - Activity diagrams
- `.blockdiag` - Block diagrams

**å…¶ä»–ï¼š**
- `.bytefield` - Bytefield
- `.excalidraw` - Excalidraw
- `.svgbob` - Svgbob
- `.tikz` - TikZ

---

## ğŸ”§ æŠ€è¡“å¯¦ä½œ

### 1. Router ä¿®æ”¹

**èˆŠé‚è¼¯ï¼š**
```javascript
app.get('/:project/livedoc/:type/:filename', ...)
// type å¿…é ˆæ˜¯ 'static' æˆ– 'dynamic'
```

**æ–°é‚è¼¯ï¼š**
```javascript
app.get('/:project/livedoc/*', ...)
// * åŒ¹é…ä»»æ„è·¯å¾‘
// æ ¹æ“šå‰¯æª”ååˆ¤æ–·è™•ç†æ–¹å¼
```

### 2. å‰¯æª”åæ˜ å°„è¡¨

```javascript
const EXTENSION_HANDLERS = {
  // éœæ…‹åœ–ç‰‡
  '.png': 'static',
  '.jpg': 'static',
  '.jpeg': 'static',
  '.gif': 'static',
  '.svg': 'static',

  // Kroki å‹•æ…‹åœ–è¡¨
  '.puml': 'plantuml',
  '.mmd': 'mermaid',
  '.d2': 'd2',
  '.c4': 'c4plantuml',
  '.structurizr': 'structurizr',
  '.bpmn': 'bpmn',
  '.nomnoml': 'nomnoml',
  '.dot': 'graphviz',
  '.graphviz': 'graphviz',
  '.vega': 'vega',
  '.vegalite': 'vegalite',
  '.ditaa': 'ditaa',
  '.erd': 'erd',
  '.dbml': 'dbml',
  '.wavedrom': 'wavedrom',
  '.pikchr': 'pikchr',
  '.wireviz': 'wireviz',
  '.nwdiag': 'nwdiag',
  '.rackdiag': 'rackdiag',
  '.packetdiag': 'packetdiag',
  '.seqdiag': 'seqdiag',
  '.actdiag': 'actdiag',
  '.blockdiag': 'blockdiag',
  '.bytefield': 'bytefield',
  '.excalidraw': 'excalidraw',
  '.svgbob': 'svgbob',
  '.tikz': 'tikz'
};
```

### 3. å‘å¾Œå…¼å®¹

ç¢ºä¿èˆŠçš„ URL ä»ç„¶å¯ç”¨ï¼š
```
âœ… http://localhost:3000/demo/livedoc/static/test.png
âœ… http://localhost:3000/demo/livedoc/dynamic/demo.puml
âœ… http://localhost:3000/demo/livedoc/architecture/system.puml (æ–°)
```

---

## âœ… æ¸¬è©¦çµæœ

**æ¸¬è©¦æ—¥æœŸ**: 2025-10-16 16:24-16:25
**Kroki ç‰ˆæœ¬**: æœ¬åœ°æœå‹™ (localhost:8000)

### æˆåŠŸçš„åœ–è¡¨é¡å‹ (13/15)

| é¡å‹ | å‰¯æª”å | æ¸¬è©¦æª”æ¡ˆ | ç‹€æ…‹ |
|------|--------|----------|------|
| D2 | `.d2` | architecture/system.d2 | âœ… SVG |
| Ditaa | `.ditaa` | diagrams/ascii.ditaa | âœ… SVG |
| SeqDiag | `.seqdiag` | diagrams/sequence.seqdiag | âœ… SVG |
| Nomnoml | `.nomnoml` | diagrams/class.nomnoml | âœ… SVG |
| ERD | `.erd` | architecture/database.erd | âœ… SVG |
| WaveDrom | `.wavedrom` | diagrams/waveform.wavedrom | âœ… SVG |
| NwDiag | `.nwdiag` | network/topology.nwdiag | âœ… SVG |
| ActDiag | `.actdiag` | process/activity.actdiag | âœ… SVG |
| PlantUML | `.puml` | dynamic/demo.puml | âœ… SVG |
| Mermaid | `.mmd` | dynamic/flow.mmd | âœ… SVG |
| PNG | `.png` | static/test.png | âœ… PNG |
| SVG | `.svg` | static/test.svg | âœ… SVG |

### å¤±æ•—çš„åœ–è¡¨é¡å‹ (2/15)

| é¡å‹ | å‰¯æª”å | æ¸¬è©¦æª”æ¡ˆ | éŒ¯èª¤ | æ ¹æœ¬åŸå›  |
|------|--------|----------|------|----------|
| Vega-Lite | `.vegalite` | diagrams/chart.vegalite | âŒ Kroki 500 | æ¸¬è©¦æª”æ¡ˆèªæ³•éŒ¯èª¤ |
| BPMN | `.bpmn` | process/workflow.bpmn | âŒ Kroki 503 | **ç¼ºå°‘ BPMN Companion Container**ï¼ˆå·²ä¿®å¾©ï¼‰ |

**éŒ¯èª¤åˆ†æ**ï¼š

**BPMN 503 éŒ¯èª¤åŸå› **ï¼š
- Kroki æ ¸å¿ƒå®¹å™¨ï¼ˆ`yuzutech/kroki`ï¼‰ä¸åŒ…å« BPMN æ¸²æŸ“å¼•æ“
- BPMN éœ€è¦å–®ç¨çš„ companion container: `yuzutech/kroki-bpmn`
- è¿”å› 503 = Service Unavailableï¼Œå› ç‚º Kroki ç„¡æ³•é€£æ¥åˆ° BPMN æœå‹™

**ä¿®å¾©æ–¹å¼**ï¼š
- æ›´æ–° `docker-compose.yml` æ·»åŠ  BPMNã€Excalidraw companion containers
- é…ç½®ç’°å¢ƒè®Šæ•¸ï¼š`KROKI_BPMN_HOST=bpmn`

**é‡æ–°æ¸¬è©¦å¾Œé æœŸ**ï¼š
- BPMN æ‡‰è©²å¯ä»¥æ­£å¸¸æ¸²æŸ“ SVG

### å‘å¾Œå…¼å®¹é©—è­‰

âœ… **v0.1 æ ¼å¼å®Œå…¨å…¼å®¹**
- `static/test.png` â†’ æˆåŠŸ
- `static/test.svg` â†’ æˆåŠŸ
- `dynamic/demo.puml` â†’ æˆåŠŸ
- `dynamic/flow.mmd` â†’ æˆåŠŸ

âœ… **v0.3 è‡ªç”±è·¯å¾‘å®Œå…¨æ”¯æ´**
- `architecture/system.d2` â†’ æˆåŠŸ
- `diagrams/class.nomnoml` â†’ æˆåŠŸ
- `network/topology.nwdiag` â†’ æˆåŠŸ
- `process/activity.actdiag` â†’ æˆåŠŸ

### æ—¥èªŒç¯„ä¾‹

```
[2025-10-16 16:24:49] INFO  | architecture/system.d2 | Compiled d2 â†’ SVG
[2025-10-16 16:24:51] INFO  | diagrams/ascii.ditaa | Compiled ditaa â†’ SVG
[2025-10-16 16:25:00] ERROR | diagrams/chart.vegalite | Kroki returned status 500
[2025-10-16 16:25:01] ERROR | process/workflow.bpmn | Kroki returned status 503
[2025-10-16 16:25:06] INFO  | diagrams/sequence.seqdiag | Compiled seqdiag â†’ SVG
[2025-10-16 16:25:07] INFO  | diagrams/class.nomnoml | Compiled nomnoml â†’ SVG
[2025-10-16 16:25:08] INFO  | architecture/database.erd | Compiled erd â†’ SVG
[2025-10-16 16:25:08] INFO  | static/test.png      | Served as image/png
[2025-10-16 16:25:08] INFO  | static/test.svg      | Served as image/svg+xml
[2025-10-16 16:25:08] INFO  | dynamic/flow.mmd     | Compiled mermaid â†’ SVG
[2025-10-16 16:25:10] INFO  | diagrams/waveform.wavedrom | Compiled wavedrom â†’ SVG
[2025-10-16 16:25:13] INFO  | network/topology.nwdiag | Compiled nwdiag â†’ SVG
[2025-10-16 16:25:13] INFO  | process/activity.actdiag | Compiled actdiag â†’ SVG
[2025-10-16 16:25:13] INFO  | dynamic/demo.puml    | Compiled plantuml â†’ SVG
```

### çµè«–

**v0.3 æ ¸å¿ƒåŠŸèƒ½å·²å®Œæˆä¸¦é©—è­‰ï¼š**

âœ… **SVG è¼¸å‡º** - æ‰€æœ‰å‹•æ…‹åœ–è¡¨çµ±ä¸€è¼¸å‡º SVG æ ¼å¼
âœ… **è‡ªç”±è·¯å¾‘** - æ”¯æ´ä»»æ„å­ç›®éŒ„çµæ§‹ï¼ˆarchitecture/, diagrams/, network/, process/ï¼‰
âœ… **å¤šåœ–è¡¨æ”¯æ´** - æˆåŠŸæ”¯æ´ 10 ç¨®æ–°åœ–è¡¨é¡å‹
âœ… **å‘å¾Œå…¼å®¹** - v0.1 çš„ static/ å’Œ dynamic/ è·¯å¾‘å®Œå…¨å¯ç”¨
âœ… **Content-Type æ­£ç¢º** - SVG è¿”å› `image/svg+xml`ï¼ŒPNG è¿”å› `image/png`

**å·²çŸ¥å•é¡Œï¼š**
- ~~Vega-Lite å’Œ BPMN éœ€é€²ä¸€æ­¥æª¢æŸ¥ï¼ˆå¯èƒ½æ˜¯æ¸¬è©¦æª”æ¡ˆèªæ³•å•é¡Œï¼‰~~ â† å·²åˆ†æåŸå› 

---

## ğŸ“ æ›´æ–°è¨˜éŒ„

**2025-10-16 - v0.3 å¯¦ç¾å®Œæˆ**

**Docker é…ç½®æ›´æ–°**ï¼š
- å› ç‚º BPMNã€Excalidraw åœ–è¡¨éœ€è¦ç¨ç«‹æ¸²æŸ“å¼•æ“ï¼ˆNode.js + å°ˆç”¨åº«ï¼‰
- æ–°å¢ `kroki-bpmn`ã€`kroki-excalidraw` companion containers
- è©³è¦‹é …ç›®æ ¹ç›®éŒ„ `docker-compose.yml`

**å¾…æ¸¬è©¦é …ç›®**ï¼š
- [ ] BPMN (é æœŸå¾ 503 â†’ 200)
- [ ] Excalidraw (æ–°é¡å‹)
- [ ] Vega-Lite (ä¿®å¾©æ¸¬è©¦æª”æ¡ˆ)
- [ ] å…¶ä»– 12+ åœ–è¡¨é¡å‹

**æ¸¬è©¦å‘½ä»¤**ï¼š
```bash
docker-compose down && docker-compose up -d
npm start
```

---

**æ›´æ–°æ™‚é–“**: 2025-10-16
